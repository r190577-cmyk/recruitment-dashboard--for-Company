<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Candidate Assessment System - Complete MVP</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: transform 0.2s;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
        }
        
        .status-selected {
            background-color: #c6f6d5;
            color: #22543d;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        
        .status-rejected {
            background-color: #fed7d7;
            color: #742a2a;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        
        .status-hold {
            background-color: #feebc8;
            color: #7c2d12;
            padding: 0.5rem 1rem;
            border-radius: 20px;
        }
        
        pre {
            background: #f7fafc;
            padding: 1rem;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body class="p-4">
    
    <div class="container mx-auto max-w-6xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-white mb-2">üéì Candidate Assessment System</h1>
            <p class="text-white text-lg">Complete HR Management - All in One File</p>
        </div>

        <!-- Navigation Tabs -->
        <div class="card p-6 mb-6">
            <div class="flex flex-wrap gap-2 justify-center">
                <button onclick="showPage('home')" class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                    üè† Home
                </button>
                <button onclick="showPage('register')" class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                    ‚úçÔ∏è Take Test
                </button>
                <button onclick="showPage('admin')" class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                    üë§ Admin Panel
                </button>
            </div>
        </div>

        <!-- Home Page -->
        <div id="homePage" class="page">
            <div class="card p-8 text-center">
                <h2 class="text-3xl font-bold mb-6">Welcome to Coding Assessment Portal</h2>
                
                <div class="grid md:grid-cols-2 gap-6 mb-8">
                    <div class="border-2 border-blue-200 p-6 rounded-lg">
                        <div class="text-5xl mb-4">üë®‚Äçüéì</div>
                        <h3 class="text-xl font-semibold mb-3">For Candidates</h3>
                        <p class="text-gray-600 mb-4">Register and take the online Python coding test</p>
                        <button onclick="showPage('register')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            Start Test ‚Üí
                        </button>
                    </div>
                    
                    <div class="border-2 border-purple-200 p-6 rounded-lg">
                        <div class="text-5xl mb-4">üëî</div>
                        <h3 class="text-xl font-semibold mb-3">For HR/Admin</h3>
                        <p class="text-gray-600 mb-4">Manage tests, view results, send emails</p>
                        <button onclick="showPage('admin')" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                            Admin Panel ‚Üí
                        </button>
                    </div>
                </div>

                <div class="bg-blue-50 p-6 rounded-lg">
                    <h4 class="font-semibold mb-3">‚ú® Features:</h4>
                    <div class="grid md:grid-cols-3 gap-4 text-left">
                        <div>
                            <strong>üìù Easy Registration</strong>
                            <p class="text-sm text-gray-600">Quick sign-up process</p>
                        </div>
                        <div>
                            <strong>üíª Online Test</strong>
                            <p class="text-sm text-gray-600">3 Python coding questions</p>
                        </div>
                        <div>
                            <strong>‚ö° Instant Results</strong>
                            <p class="text-sm text-gray-600">Auto-evaluation & results</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Register Page -->
        <div id="registerPage" class="page hidden">
            <div class="card p-8 max-w-2xl mx-auto">
                <h2 class="text-3xl font-bold mb-6 text-center">Candidate Registration</h2>
                
                <form id="registerForm" onsubmit="registerCandidate(event)">
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">Full Name *</label>
                        <input type="text" id="candName" class="w-full px-4 py-2 border rounded-lg" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">Email Address *</label>
                        <input type="email" id="candEmail" class="w-full px-4 py-2 border rounded-lg" required>
                    </div>
                    
                    <div class="mb-4">
                        <label class="block text-gray-700 font-semibold mb-2">Phone Number *</label>
                        <input type="tel" id="candPhone" class="w-full px-4 py-2 border rounded-lg" required>
                    </div>
                    
                    <button type="submit" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold">
                        Register & Start Test ‚Üí
                    </button>
                </form>
            </div>
        </div>

        <!-- Test Page -->
        <div id="testPage" class="page hidden">
            <div class="card p-8">
                <h2 class="text-3xl font-bold mb-6 text-center">Python Coding Assessment</h2>
                
                <div class="bg-blue-50 p-4 rounded-lg mb-6">
                    <strong>üìã Instructions:</strong>
                    <ul class="list-disc ml-5 mt-2">
                        <li>Answer all 3 questions</li>
                        <li>Write clean Python code</li>
                        <li>You can submit only once</li>
                        <li>Results will be shown immediately</li>
                    </ul>
                </div>

                <form id="testForm" onsubmit="submitTest(event)">
                    <div class="space-y-6" id="questionsContainer">
                        <!-- Questions will be inserted here -->
                    </div>
                    
                    <div class="mt-8">
                        <button type="submit" class="w-full py-4 bg-green-600 text-white rounded-lg hover:bg-green-700 font-semibold text-lg">
                            üöÄ Submit Test
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Result Page -->
        <div id="resultPage" class="page hidden">
            <div class="card p-8 max-w-3xl mx-auto text-center">
                <h2 class="text-3xl font-bold mb-6">Your Test Results</h2>
                
                <div id="resultContent">
                    <!-- Results will be inserted here -->
                </div>
                
                <div class="mt-6">
                    <button onclick="showPage('home')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        Back to Home
                    </button>
                </div>
            </div>
        </div>

        <!-- Admin Panel -->
        <div id="adminPage" class="page hidden">
            <div class="card p-8">
                <h2 class="text-3xl font-bold mb-6">Admin Dashboard</h2>
                
                <div class="grid md:grid-cols-4 gap-4 mb-8">
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold text-blue-600" id="totalCount">0</div>
                        <div class="text-gray-600">Total Candidates</div>
                    </div>
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold text-green-600" id="selectedCount">0</div>
                        <div class="text-gray-600">Selected</div>
                    </div>
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold text-red-600" id="rejectedCount">0</div>
                        <div class="text-gray-600">Rejected</div>
                    </div>
                    <div class="bg-yellow-50 p-4 rounded-lg text-center">
                        <div class="text-3xl font-bold text-yellow-600" id="holdCount">0</div>
                        <div class="text-gray-600">On Hold</div>
                    </div>
                </div>

                <div class="flex flex-wrap gap-4 mb-8">
                    <button onclick="showAdminSection('candidates')" class="px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                        üìä View All Candidates
                    </button>
                    <button onclick="exportToExcel()" class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                        üì• Export to Excel
                    </button>
                    <button onclick="showAdminSection('upload')" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        üì§ Upload & Send Emails
                    </button>
                    <button onclick="showAdminSection('questions')" class="px-6 py-3 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                        ‚ùì Manage Questions
                    </button>
                </div>

                <!-- Admin Sections -->
                <div id="adminCandidates" class="admin-section hidden">
                    <h3 class="text-xl font-bold mb-4">All Candidates</h3>
                    <div class="overflow-x-auto">
                        <table class="w-full border-collapse" id="candidatesTable">
                            <thead class="bg-gray-100">
                                <tr>
                                    <th class="border p-3 text-left">Name</th>
                                    <th class="border p-3 text-left">Email</th>
                                    <th class="border p-3 text-left">Phone</th>
                                    <th class="border p-3 text-center">Score</th>
                                    <th class="border p-3 text-center">Status</th>
                                </tr>
                            </thead>
                            <tbody id="candidatesTableBody">
                                <!-- Candidates will be inserted here -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="adminUpload" class="admin-section hidden">
                    <h3 class="text-xl font-bold mb-4">Upload Excel & Send Emails</h3>
                    
                    <div class="bg-blue-50 p-4 rounded-lg mb-4">
                        <strong>üìã Excel Format:</strong>
                        <p>Required columns: Name, Email, Status (Selected/Rejected/Hold)</p>
                    </div>

                    <input type="file" id="excelUpload" accept=".xlsx,.xls" class="mb-4 w-full p-3 border rounded-lg">
                    <button onclick="processExcelUpload()" class="w-full py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700">
                        Upload & Preview Emails
                    </button>

                    <div id="emailPreview" class="mt-6 hidden">
                        <!-- Email previews will appear here -->
                    </div>
                </div>

                <div id="adminQuestions" class="admin-section hidden">
                    <h3 class="text-xl font-bold mb-4">Manage Questions</h3>
                    
                    <div id="questionsList" class="space-y-4 mb-6">
                        <!-- Questions will be listed here -->
                    </div>

                    <div class="bg-green-50 p-6 rounded-lg">
                        <h4 class="font-bold mb-4">Add New Question</h4>
                        <div class="space-y-3">
                            <input type="text" id="newQuestion" placeholder="Question text" class="w-full p-3 border rounded-lg">
                            <textarea id="newAnswer" placeholder="Expected answer" rows="3" class="w-full p-3 border rounded-lg"></textarea>
                            <button onclick="addQuestion()" class="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                Add Question
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // ==================== DATA STORAGE ====================
        let candidates = JSON.parse(localStorage.getItem('candidates') || '[]');
        let questions = JSON.parse(localStorage.getItem('questions') || JSON.stringify([
            {
                id: 1,
                question: "Write a Python program to print 'Hello, World!'",
                answer: 'print("Hello, World!")'
            },
            {
                id: 2,
                question: "Write a Python function that returns the sum of two numbers",
                answer: "def add(a, b):\n    return a + b"
            },
            {
                id: 3,
                question: "Write a Python program to print numbers from 1 to 5",
                answer: "for i in range(1, 6):\n    print(i)"
            }
        ]));

        let currentCandidate = null;

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('candidates', JSON.stringify(candidates));
            localStorage.setItem('questions', JSON.stringify(questions));
        }

        // ==================== PAGE NAVIGATION ====================
        function showPage(pageName) {
            document.querySelectorAll('.page').forEach(page => page.classList.add('hidden'));
            document.getElementById(pageName + 'Page').classList.remove('hidden');
            
            if (pageName === 'admin') {
                updateAdminStats();
                showAdminSection('candidates');
            }
            
            if (pageName === 'register') {
                document.getElementById('registerForm').reset();
            }
        }

        function showAdminSection(section) {
            document.querySelectorAll('.admin-section').forEach(s => s.classList.add('hidden'));
            document.getElementById('admin' + section.charAt(0).toUpperCase() + section.slice(1)).classList.remove('hidden');
            
            if (section === 'candidates') {
                displayCandidates();
            } else if (section === 'questions') {
                displayQuestions();
            }
        }

        // ==================== CANDIDATE REGISTRATION ====================
        function registerCandidate(event) {
            event.preventDefault();
            
            currentCandidate = {
                id: Date.now(),
                name: document.getElementById('candName').value,
                email: document.getElementById('candEmail').value,
                phone: document.getElementById('candPhone').value,
                registeredAt: new Date().toISOString(),
                answers: [],
                score: 0,
                status: 'Pending'
            };
            
            // Show test page with questions
            loadTestQuestions();
            showPage('test');
        }

        function loadTestQuestions() {
            const container = document.getElementById('questionsContainer');
            container.innerHTML = '';
            
            questions.forEach((q, index) => {
                container.innerHTML += `
                    <div class="border-2 border-gray-200 p-6 rounded-lg">
                        <h4 class="text-lg font-semibold mb-3">
                            <span class="bg-blue-600 text-white px-3 py-1 rounded">Q${index + 1}</span>
                            ${q.question}
                        </h4>
                        <textarea 
                            id="answer_${q.id}" 
                            rows="5" 
                            class="w-full p-3 border rounded-lg font-mono text-sm"
                            placeholder="Write your Python code here..."
                            required
                        ></textarea>
                    </div>
                `;
            });
        }

        // ==================== TEST SUBMISSION ====================
        function submitTest(event) {
            event.preventDefault();
            
            let score = 0;
            const answers = [];
            
            questions.forEach(q => {
                const userAnswer = document.getElementById('answer_' + q.id).value.trim().toLowerCase();
                const expectedAnswer = q.answer.trim().toLowerCase();
                
                answers.push({
                    questionId: q.id,
                    question: q.question,
                    userAnswer: document.getElementById('answer_' + q.id).value,
                    correct: userAnswer.includes(expectedAnswer) || expectedAnswer.includes(userAnswer)
                });
                
                if (userAnswer.includes(expectedAnswer) || expectedAnswer.includes(userAnswer)) {
                    score++;
                }
            });
            
            currentCandidate.answers = answers;
            currentCandidate.score = score;
            
            // Determine status
            if (score >= 3) {
                currentCandidate.status = 'Selected';
            } else if (score >= 2) {
                currentCandidate.status = 'Hold';
            } else {
                currentCandidate.status = 'Rejected';
            }
            
            candidates.push(currentCandidate);
            saveData();
            
            showResults();
        }

        function showResults() {
            const container = document.getElementById('resultContent');
            const c = currentCandidate;
            
            let statusClass = 'status-hold';
            let statusIcon = '‚è≥';
            let statusMessage = 'Your application is under review.';
            
            if (c.status === 'Selected') {
                statusClass = 'status-selected';
                statusIcon = '‚úÖ';
                statusMessage = 'Congratulations! You have been selected. We will contact you soon.';
            } else if (c.status === 'Rejected') {
                statusClass = 'status-rejected';
                statusIcon = '‚ùå';
                statusMessage = 'Thank you for your interest. We encourage you to apply for future opportunities.';
            }
            
            container.innerHTML = `
                <div class="mb-6">
                    <h3 class="text-2xl font-semibold mb-2">Hello, ${c.name}!</h3>
                    <p class="text-gray-600">${c.email}</p>
                </div>

                <div class="grid md:grid-cols-2 gap-6 mb-6">
                    <div class="bg-blue-50 p-6 rounded-lg">
                        <div class="text-5xl font-bold text-blue-600 mb-2">${c.score}/3</div>
                        <div class="text-gray-700">Your Score</div>
                    </div>
                    <div class="bg-gray-50 p-6 rounded-lg">
                        <div class="text-4xl mb-2">${statusIcon}</div>
                        <div class="mb-2"><span class="${statusClass}">${c.status}</span></div>
                        <div class="text-gray-700">Status</div>
                    </div>
                </div>

                <div class="bg-blue-50 p-6 rounded-lg mb-6">
                    <p class="text-lg">${statusMessage}</p>
                </div>

                <div class="text-left bg-gray-50 p-6 rounded-lg">
                    <h4 class="font-bold mb-3">Your Answers:</h4>
                    ${c.answers.map((a, i) => `
                        <div class="mb-4">
                            <p class="font-semibold mb-2">Q${i+1}: ${a.question}</p>
                            <pre class="text-sm">${a.userAnswer}</pre>
                            <p class="mt-1 ${a.correct ? 'text-green-600' : 'text-red-600'}">
                                ${a.correct ? '‚úì Correct' : '‚úó Incorrect'}
                            </p>
                        </div>
                    `).join('')}
                </div>
            `;
            
            showPage('result');
        }

        // ==================== ADMIN FUNCTIONS ====================
        function updateAdminStats() {
            document.getElementById('totalCount').textContent = candidates.length;
            document.getElementById('selectedCount').textContent = candidates.filter(c => c.status === 'Selected').length;
            document.getElementById('rejectedCount').textContent = candidates.filter(c => c.status === 'Rejected').length;
            document.getElementById('holdCount').textContent = candidates.filter(c => c.status === 'Hold').length;
        }

        function displayCandidates() {
            const tbody = document.getElementById('candidatesTableBody');
            
            if (candidates.length === 0) {
                tbody.innerHTML = '<tr><td colspan="5" class="border p-4 text-center text-gray-500">No candidates yet</td></tr>';
                return;
            }
            
            tbody.innerHTML = candidates.map(c => `
                <tr>
                    <td class="border p-3">${c.name}</td>
                    <td class="border p-3">${c.email}</td>
                    <td class="border p-3">${c.phone}</td>
                    <td class="border p-3 text-center font-bold">${c.score}/3</td>
                    <td class="border p-3 text-center">
                        <span class="status-${c.status.toLowerCase()}">${c.status}</span>
                    </td>
                </tr>
            `).join('');
        }

        function exportToExcel() {
            if (candidates.length === 0) {
                alert('No candidates to export!');
                return;
            }

            const data = candidates.map(c => ({
                Name: c.name,
                Email: c.email,
                Phone: c.phone,
                Score: c.score,
                Status: c.status,
                'Registered At': new Date(c.registeredAt).toLocaleString()
            }));

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Candidates');
            XLSX.writeFile(wb, `candidates_${Date.now()}.xlsx`);
            
            alert('Excel file downloaded!');
        }

        function processExcelUpload() {
            const file = document.getElementById('excelUpload').files[0];
            if (!file) {
                alert('Please select an Excel file first!');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet);

                displayEmailPreviews(jsonData);
            };
            reader.readAsArrayBuffer(file);
        }

        function displayEmailPreviews(data) {
            const container = document.getElementById('emailPreview');
            container.classList.remove('hidden');
            
            const emailTemplates = {
                'Selected': {
                    subject: 'Congratulations - You\'re Selected! üéâ',
                    body: 'We are thrilled to inform you that you have been selected!\n\nWelcome to the team!'
                },
                'Rejected': {
                    subject: 'Application Update',
                    body: 'Thank you for your interest. We encourage you to apply for future openings.'
                },
                'Hold': {
                    subject: 'Application Status Update',
                    body: 'We are currently reviewing applications. We will update you soon.'
                }
            };
            
            container.innerHTML = `
                <h4 class="font-bold mb-4">Email Previews (${data.length} emails):</h4>
                <div class="space-y-4 max-h-96 overflow-y-auto">
                    ${data.map(row => {
                        const status = row.Status || row.status;
                        const template = emailTemplates[status] || emailTemplates['Hold'];
                        const name = row.Name || row.name || 'Candidate';
                        const email = row.Email || row.email;
                        
                        return `
                            <div class="border p-4 rounded-lg bg-white">
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <strong>${name}</strong>
                                        <div class="text-sm text-gray-600">${email}</div>
                                    </div>
                                    <span class="status-${status.toLowerCase()}">${status}</span>
                                </div>
                                <div class="text-sm bg-gray-50 p-3 rounded mt-2">
                                    <div class="font-semibold mb-1">Subject: ${template.subject}</div>
                                    <div class="text-gray-700">${template.body}</div>
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
                <div class="mt-4 bg-green-50 p-4 rounded-lg">
                    <p class="text-green-800">
                        ‚úÖ Preview complete! In production, these ${data.length} emails would be sent via SMTP.
                    </p>
                </div>
            `;
        }

        function displayQuestions() {
            const container = document.getElementById('questionsList');
            container.innerHTML = questions.map((q, index) => `
                <div class="border p-4 rounded-lg">
                    <div class="flex justify-between items-start">
                        <div class="flex-grow">
                            <h4 class="font-semibold mb-2">Q${index + 1}: ${q.question}</h4>
                            <pre class="text-sm bg-gray-50 p-2 rounded">${q.answer}</pre>
                        </div>
                        <button onclick="deleteQuestion(${q.id})" class="ml-4 px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addQuestion() {
            const question = document.getElementById('newQuestion').value;
            const answer = document.getElementById('newAnswer').value;
            
            if (!question || !answer) {
                alert('Please fill in both fields!');
                return;
            }
            
            questions.push({
                id: Date.now(),
                question: question,
                answer: answer
            });
            
            saveData();
            displayQuestions();
            
            document.getElementById('newQuestion').value = '';
            document.getElementById('newAnswer').value = '';
            
            alert('Question added successfully!');
        }

        function deleteQuestion(id) {
            if (confirm('Delete this question?')) {
                questions = questions.filter(q => q.id !== id);
                saveData();
                displayQuestions();
            }
        }

        // ==================== INITIALIZE ====================
        window.onload = function() {
            showPage('home');
        };
    </script>
</body>
</html>
